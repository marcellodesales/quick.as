$(function(){$("video").quickCastPlayer(),$("a.embed").on("click",function(){if(0===$("a.embed textarea").length){$("a.embed span").hide();var e=$(this).attr("data-width"),t=$(this).attr("data-height"),i=parseFloat(e/t);e>300&&t>300?$(this).append("<textarea><iframe name='quickcast' src='http://"+window.location.host+"/embed"+window.location.pathname+"' scrolling='no' frameborder='0' width='100%' allowfullscreen></iframe><script>!function(){function n(){var n=document.getElementsByName('quickcast')\nfor(var e in n){var t=n[e].offsetWidth\nn[e].height=t/"+i.toFixed(2)+"+'px'}}n(),window.onresize=n,window.addEventListener('message',function(n){if(n.data.indexOf('//quick.as/') != -1)window.location.href=n.data},!1)}()\n</script></textarea>"):$(this).append("<textarea><iframe name='quickcast' src='http://"+window.location.host+"/embed"+window.location.pathname+"' scrolling='no' frameborder='0' width='"+e+"' height='"+t+"' allowfullscreen></iframe></textarea>")}return!1})}),function(e){e.fn.quickCastPlayer=function(){var t=e("video").attr("data-width"),i=e("video").attr("data-height"),n=parseFloat(t/i),a=parseFloat(i/t);if(e(".video").width(),/mobile/i.test(navigator.userAgent)){var s=e("body").width();return e("video").attr("controls",!0).attr("width",s).attr("height",s/n.toFixed(2)),e("body").removeClass("loading"),e("video").css("opacity",1),e(window).resize(function(){var t=e("body").width();e("video").attr("width",t).attr("height",t/n.toFixed(2))}),void 0}return this.each(function(){var t=e(this)[0];if(/chrome|firefox|opera/i.test(navigator.userAgent)){var i=e(this).find("source[type='video/webm']");e(this).children().remove(),e(this).append(i)}else{var i=e(this).find("source[type='video/mp4']");/-small.mp4/i.test(i.src)&&(i.src=i.src.replace("-small.mp4",".mp4")),e(this).children().remove(),e(this).append(i)}t.load(),e("body").removeClass("loading"),t.addEventListener("loadeddata",function(){function t(){h.currentTime>=f&&(h.currentTime=0),F=l.find(".progress").width(),k(),l.find(".progress-bar").css({width:x+"px"});var t=x-l.find(".progress-button").width();0>t&&(t=0),l.find(".progress-button").css({left:t+"px"});var i=e(window).height();e("video").height()>e(window).height()?(e("video").css("max-width",(i/a.toFixed(2)).toFixed(2)).css("max-height",i),e(".video").css("width",(i/a.toFixed(2)).toFixed(2)).css("max-height",i)):(e("video").css("max-width",s).css("max-height","auto"),e(".video").css("width","auto").css("max-height","auto")),T()}var i=e(this),n=i.attr("data-width"),o=i.attr("data-height"),d=i.attr("data-intro"),r=i.attr("data-outro"),u=!1;300>=n||300>=o?(u=!0,i.wrap('<div class="video micro"></div>')):i.wrap('<div class="video"></div>'),e(".video").css("max-width",n+"px"),u===!1&&""!=d&&e(".play-button").append("<div><span>"+d+"</span></div>");var c=e(window).height();e("video").height()>e(window).height()?(e("video").css("max-width",(c/a.toFixed(2)).toFixed(2)).css("max-height",c),e(".video").css("width",(c/a.toFixed(2)).toFixed(2)).css("max-height",c)):(e("video").css("max-width",s).css("max-height","auto"),e(".video").css("width","auto").css("max-height","auto"));var l=i.parent(".video");e('<div class="play-button"></div><div class="player"><div class="pause-button"></div><div class="progress"><div class="progress-bar"><div class="progress-button"> </div></div></div><div class="time"><span class="ctime">00:00</span><span class="stime"> / </span><span class="ttime">00:00</span></div><div class="volume"><div class="volume-icon v-change-0"><span> </span></div></div><div class="fullscreen"><a href="#"> </a></div><div class="link"><a href="#"> </a></div></div>').appendTo(l),l.bind("selectstart",function(){return!1});var p,h=e(this)[0],f=h.duration,v=document.title,m=!1,g=!1,w=!1,b=!1,y=0,x=0,F=l.find(".progress").width(),T=function(){var t=h.buffered;if(l.find("[class^=buffered]").remove(),t.length>0)for(var i=t.length;i--;){$maxBuffer=t.end(i),$minBuffer=t.start(i);var n=100*($minBuffer/f),a=100*(($maxBuffer-$minBuffer)/f);e('<div class="buffered"></div>').css({left:n+"%",width:a+"%"}).appendTo(l.find(".progress"))}};T();var k=function(){var t=Math.round(e(".progress-bar").width()/F*f),i=h.currentTime,n=0,a=Math.floor(t/60),s=Math.floor(f/60),o=Math.round(f-60*s);t&&(n=Math.round(t)-60*a,n>59&&(n=Math.round(t)-60*a,60==n&&(a=Math.round(t/60),n=0))),x=i/f*F,10>n&&(n="0"+n),10>o&&(o="0"+o),l.find(".progress-bar").css({width:x+"px"});var r=x-l.find(".progress-button").width();0>r&&(r=0),l.find(".progress-button").css({left:r+"px"}),l.find(".ctime").html(a+":"+n),l.find(".ttime").html(s+":"+o),h.currentTime>0&&0==h.paused&&0==h.ended&&T(),document.title=w?"Playing "+a+":"+n+" / "+s+":"+o:h.currentTime>0?"Paused "+a+":"+n+" / "+s+":"+o:v,u===!1&&0>=i&&""!=d&&(0===e(".play-button div").length&&e(".play-button").append("<div><span></span></div>"),e(".play-button div span").text(d))};if(k(),h.addEventListener("timeupdate",k),e(window).resize(function(){t()}),u===!1)l.find(".player").css("opacity",1),setTimeout(function(){l.find(".player").css("opacity",0)},3e3);else{l.find(".player").css("display","none"),e(".play-button").append("<span></span>");var $=n/1.4;n>o&&($=o/1.4),e(".play-button span").css("margin","-"+parseInt($/2)+"px 0 0 -"+parseInt($/2)+"px"),e(".play-button span").css({width:parseInt($)+"px",height:parseInt($)+"px"})}l.find(".play-button, .pause-button").on("click",function(){w=h.currentTime>0&&0==h.paused&&0==h.ended?!1:!0,0==w?(h.currentTime>0&&0==h.ended&&e(".play-button div").hide(),e(".play-button, .pause-button").removeClass("playing"),h.pause(),T()):(e(".play-button, .pause-button").addClass("playing"),b=!0,h.play())}),l.find(".progress").on("mousedown",function(e){m=!0,1==w&&h.pause(),y=e.pageX-l.find(".progress").offset().left,p=y/F*f,h.currentTime=p}),e("body, html").on("mousemove",function(t){var i=null;if(1!=u&&(l.on("mouseover",function(){clearTimeout(i),l.find(".player").css("opacity",1)}),l.on("mouseout",function(){i=setTimeout(function(){l.find(".player").css("opacity",0)},1e3)})),1==m){h.currentTime>0?e(".play-button div").hide(200):e(".play-button div").show(200),$draggingProgress=!0;var n=0;l.find(".progress-button").width(),y=t.pageX-l.find(".progress").offset().left,0>y?(n=0,h.currentTime=0):y>F?(h.currentTime=f,n=F):(n=y,p=y/F*f,h.currentTime=p),l.find(".progress-bar").css({width:n+"px"});var a=x-l.find(".progress-button").width();0>a&&(a=0),l.find(".progress-button").css({left:a+"px"})}}),h.addEventListener("playing",function(){t()}),h.addEventListener("ended",function(){w=!1,u===!1&&""!=r&&(0===e(".play-button div").length&&e(".play-button").append("<div><span></span></div>"),e(".play-button div span").text(r),e(".play-button div").show()),e(".play-button, .pause-button").removeClass("playing")}),l.find(".volume").on("click",function(){1==h.volume?(h.volume=0,l.find(".volume").addClass("off")):(h.volume=1,l.find(".volume").removeClass("off"))}),e("body, html").on("mouseup",function(){m=!1,g=!1,$draggingProgress=!1,1==w&&h.play(),T()}),h.requestFullscreen||h.mozRequestFullScreen||h.webkitRequestFullScreen||e(".fullscreen").hide(),e(".fullscreen").on("click",function(){h.requestFullscreen?h.requestFullscreen():h.mozRequestFullScreen?h.mozRequestFullScreen():h.webkitRequestFullScreen&&h.webkitRequestFullScreen()}),e(".link").on("click",function(){return window.location.href=window.location.href,!1})})})}}(jQuery);
